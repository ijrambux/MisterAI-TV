<nav class="p-4 bg-black/90 sticky top-0 z-50 flex flex-wrap gap-4 justify-between items-center border-b border-zinc-800">
    <h1 class="text-xl font-bold text-red-600">MisterAI PRO</h1>
    <input type="text" id="search" onkeyup="filterChannels()" placeholder="ابحث عن قناة أو فيلم..." class="bg-zinc-800 px-4 py-1.5 rounded-lg text-sm w-full md:w-64 border border-zinc-700 outline-none focus:border-red-500">
    <div class="flex gap-2">
        <button onclick="loadData('get_live_streams')" class="bg-red-600 px-4 py-1.5 rounded-lg text-sm font-bold">قنوات</button>
        <button onclick="loadData('get_vod_streams')" class="bg-zinc-800 px-4 py-1.5 rounded-lg text-sm">أفلام</button>
    </div>
</nav>

<script>
    let allData = []; // لتخزين البيانات محلياً للبحث السريع

    async function loadData(type) {
        const grid = document.getElementById('grid');
        grid.innerHTML = '<div class="col-span-full text-center py-20 animate-pulse">جاري الاتصال بالسيرفر...</div>';
        
        try {
            const res = await fetch(`/api/content?type=${type}`);
            allData = await res.json();
            displayData(allData);
        } catch (e) { grid.innerHTML = "خطأ في الاتصال"; }
    }

    function displayData(data) {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        data.forEach(item => {
            const name = item.name || item.title;
            const img = item.stream_icon || 'https://via.placeholder.com/300x450?text=' + name;
            
            const card = document.createElement('div');
            card.className = 'poster-card bg-zinc-900 rounded-lg overflow-hidden';
            card.innerHTML = `
                <img src="${img}" loading="lazy" class="poster-img w-full">
                <p class="p-2 text-[10px] text-center truncate">${name}</p>
            `;
            // إضافة رابط التشغيل (كما في الكود السابق)
            card.onclick = () => playVideo(item, currentType); 
            grid.appendChild(card);
        });
    }

    // بحث فوري بدون تحميل الصفحة
    function filterChannels() {
        const query = document.getElementById('search').value.toLowerCase();
        const filtered = allData.filter(i => (i.name || i.title).toLowerCase().includes(query));
        displayData(filtered);
    }
</script>
